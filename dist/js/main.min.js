(()=>{"use strict";const e={data:[],getCardById(e){const[t]=this.data.filter((t=>t.id===e));return t},delCardById(e){this.data=this.data.filter((t=>t.id!==e))},sortNow(){this.data.sort(((e,t)=>t.id-e.id)).sort(((e,t)=>e.date>t.date?-1:e.date<t.date?1:0)).sort(((e,t)=>t.status<e.status?-1:t.status>e.status?1:0))}};class t{constructor(e=document.body){this.wrapper=e,this.date=(new Date).toLocaleString("ua").slice(0,-3)}showLoginForm(){this.wrapper.classList.remove("modal--hide"),this.wrapper.innerHTML="";const e=document.createElement("div");e.classList.add("modal__content-wrapper","modal__content-wrapper--login"),this.wrapper.append(e),e.innerHTML='\n            <span class="modal-close">✖</span>\n            <div class="modal__content">\n                <h3 class="modal__content-title">Welcome Back</h3>\n                <div class="modal__content-img">\n                    <picture>\n                        <source srcset="./dist/assets/images/log-icon.webp" type="image/webp">\n                            <img class="modal__content-icon" src="./dist/assets/images/log-icon.png" alt="login">\n                    </picture>\n                </div>\n                <form class="form-login">\n                    <input class="form-login__input" type="text" name="username" placeholder="email">\n                    <input class="form-login__input" type="password" id="password" name="password" placeholder="password">\n                    <button class="btn btn--small disabled" type="submit" disabled>login</button>\n                </form>\n            </div>\n        ',this.closeModal("login"),this.submitButtonActivation()}submitButtonActivation(){const e=this.wrapper.querySelectorAll("input"),t=this.wrapper.querySelector("button");e.forEach((s=>s.addEventListener("input",(()=>{[...e].every((e=>!!e.value))?(t.classList.remove("disabled"),t.removeAttribute("disabled")):t.classList.add("disabled")}))))}closeModal(e){const t=this.wrapper.querySelector(".modal-close"),s=this.wrapper.querySelector('button[type="submit"]'),i=this.wrapper.querySelector(".modal__content-wrapper"),a=()=>{i.remove(),this.wrapper.classList.add("modal--hide")};"login"===e&&t.addEventListener("click",a),"visit"===e&&this.wrapper.addEventListener("click",(function(e){e.target.closest(".modal__content-wrapper")&&e.target!==t&&e.target!==s||a()}))}showDefaultVisit(){this.wrapper.classList.remove("modal--hide"),this.wrapper.innerHTML="";const e=document.createElement("div");e.classList.add("modal__content-wrapper","modal__content-wrapper--visit"),this.wrapper.append(e),e.innerHTML='\n            <span class="modal-close modal-close--large">×</span>\n            <div class="modal__content modal__content--visit">\n                <h3 class="modal__content-title modal__content-title--visit">VISIT FORM</h3>\n                <div class="modal__content-img">\n                    <img class="modal__content-icon modal__content-icon--visit" src="./dist/assets/images/patient.png" alt="LOGO">              \n                </div>\n                <form class="form-visit">\n                    <label class="form-visit__label">Doctor\n                        <select class="form-visit__select" id="select-doctor" name="specialist">\n                            <option value="" disabled selected>Select specialist</option>\n                            <option value="cardiologist">Cardiologist</option>\n                            <option value="dentist">Dentist</option>\n                            <option value="therapist">Therapist</option>\n                        </select>\n                    </label>\n                    <label class="form-visit__label" id="form-patient-name">Patient name\n                        <input class="form-visit__input" type="text" id="patient-name" name="patient-name" placeholder="Enter full patient name" required>\n                    </label>\n                    <label class="form-visit__label" id="form-purpose">Purpose of the visit\n                        <input class="form-visit__input" type="text" id="purpose" name="purpose" placeholder="Enter purpose of the visit" required>\n                    </label>\n                    <label class="form-visit__label" id="form-description">Description of the visit\n                        <input class="form-visit__input" type="text" id="description" name="description" placeholder="Enter description of the visit" required>\n                    </label>\n                    <label class="form-visit__label" id="form-urgency">Urgency of the visit\n                        <div class="label-container-radio">\n                            <label class="form-visit__label--radio"> Normal\n                                <input type="radio" name="urgency" id="urgency-normal" value="normal" checked>\n                            </label>\n                            <label class="form-visit__label--radio"> Priority\n                                <input type="radio" name="urgency" id="urgency-priority" value="priority">\n                            </label>\n                            <label class="form-visit__label--radio"> Urgent\n                                <input type="radio" name="urgency" id="urgency-urgent" value="urgent">\n                            </label>\n                        </div>\n                    </label>\n                    <div class="form-visit__specialist"></div>\n                </form>\n            </div>',this.closeModal("visit"),this.checkboxActivation()}checkboxActivation(){const e=this.wrapper.querySelectorAll('[name="urgency"]');this.wrapper.querySelector("#form-urgency").addEventListener("click",(t=>{e.forEach((e=>{e===t.target?e.setAttribute("checked",!0):e.removeAttribute("checked")}))}))}showSpecificFields(e){const t=this.wrapper.querySelector(".form-visit__specialist");"cardiologist"===e?t.innerHTML='\n               <label class="form-visit__label" id="form-pressure">Normal pressure\n                    <div class="form-pressure__container">\n                        <input class="form-visit__input form-visit__input--shot" type="number" id="pressure-top" name="pressure" placeholder="top" required>\n                        <span>⁄</span>\n                        <input class="form-visit__input form-visit__input--shot" type="number" id="pressure-bottom" name="pressure" placeholder="bottom" required>\n                    </div>\n                </label>\n                <label class="form-visit__label" id="form-body-mass">Body mass index\n                    <div class="form-body-mass__container">\n                    <output class="form-visit__label-output">25</output>\n                    <input oninput="this.previousElementSibling.value = this.value" class="form-visit__input" type="range" min="0" max="50" step="1" value="25" id="mass-index" name="mass-index" placeholder="Enter patient body mass index">\n                    </div>\n                </label>\n                <label class="form-visit__label" id="form-past-diseases">Past diseases of the cardiovascular system\n                    <textarea class="form-visit__text-area" placeholder="Enter pacient past diseases of the cardiovascular system" required></textarea>\n                </label>\n                <label class="form-visit__label" id="form-age">Patient age\n                    <input class="form-visit__input form-visit__input--shot" type="number" id="age" name="age" placeholder="Age" required>\n                </label>\n                <button class="btn btn--big btn--bg-prime submit disabled">Create visit</button>':"dentist"===e?t.innerHTML='\n                <label class="form-visit__label" id="form-date">Date of last visit\n                    <input class="form-visit__input" type="date" id="visit" name="visit" placeholder="Enter date of last visit" required>\n                </label>\n                <button class="btn btn--big btn--bg-prime submit disabled">Create visit</button>':"therapist"===e&&(t.innerHTML='\n                <label class="form-visit__label" id="form-age">Patient age\n                    <input class="form-visit__input form-visit__input--shot" type="number" id="age" name="age" placeholder="Age" required>\n                </label>\n                <button class="btn btn--big btn--bg-prime submit disabled">Create visit</button>'),this.closeModal("visit"),this.submitButtonActivation()}createVisitParams(e){e.preventDefault();const t=this.wrapper.querySelector("#purpose"),s=this.wrapper.querySelector("#description"),i=this.wrapper.querySelector("#patient-name"),a=this.wrapper.querySelector('input[name="urgency"][checked="true"]')||"normal",r=this.wrapper.querySelector("#pressure-top")||"",n=this.wrapper.querySelector("#pressure-bottom")||"",o=this.wrapper.querySelector("#mass-index")||"",d=this.wrapper.querySelector(".form-visit__text-area")||"",c=this.wrapper.querySelector("#age")||"",l=this.wrapper.querySelector("#visit")||"";return this.date,{patient:i.value,purpose:t.value,description:s.value,urgency:a.value||"normal",date:this.date,...!!l.value&&{lastVisit:l.value},...!!r.value&&!!n.value&&{pressure:`${r.value}/${n.value}`},...!!o.value&&{BMI:o.value},...!!d.value&&{diseases:d.value},...!!c.value&&{age:c.value}}}addCurrentCardInfo({purpose:e,description:t,patient:s,urgency:i,pressure:a,BMI:r,diseases:n,age:o,lastVisit:d}){this.wrapper.querySelector("#select-doctor").parentNode.remove(),e&&(this.wrapper.querySelector("#purpose").value=e),t&&(this.wrapper.querySelector("#description").value=t),s&&(this.wrapper.querySelector("#patient-name").value=s),i&&this.wrapper.querySelector(`input[name="urgency"][value="${i}"]`).setAttribute("checked",!0),a&&(this.wrapper.querySelector("#pressure-top").value=a.slice(0,a.indexOf("/")),this.wrapper.querySelector("#pressure-bottom").value=a.slice(a.indexOf("/")+1)),r&&(this.wrapper.querySelector(".form-visit__label-output").value=r,this.wrapper.querySelector("#mass-index").value=r),n&&(this.wrapper.querySelector(".form-visit__text-area").value=n),o&&(this.wrapper.querySelector("#age").value=o),d&&(this.wrapper.querySelector("#visit").value=d)}showEditModal({doctor:e,...t}){this.showDefaultVisit(),this.showSpecificFields(e),this.addCurrentCardInfo(t)}}class s{constructor({id:e,doctor:t,purpose:s,description:i,urgency:a,patient:r,pressure:n,BMI:o,diseases:d,age:c,lastVisit:l,status:u,date:p}){this.id=e,this.doctor=t,this.purpose=s,this.description=i,this.urgency=a,this.patient=r,this.status=u,d&&(this.diseases=d),o&&(this.BMI=o),n&&(this.pressure=n),l&&(this.lastVisit=l),c&&(this.age=c),this.date=p}render(){const e=document.querySelector(".cards__content"),t=document.createElement("div");t.classList.add("card"),t.setAttribute("id",this.id),e.append(t),t.insertAdjacentHTML("afterbegin",`\n            <div class="card__container">\n                <span class="card-date">Last update:<br>${this.date}</span>\n                <span class="card-change">✎</span>\n                <span class="card-del">✖</span>\n                <div class="card__element card-title">\n                    <div class="card-title__doctor">\n                        <div class="card-title__doctor-head">DOCTOR:</div>\n                        <div class="card-title__doctor-text">\n                            <div class="card-title__doctor-text-icon">\n                                <picture>\n                                    <source srcset="./dist/assets/images/сard/therapist.webp" type="image/webp">\n                                    <img class="doctor-icon" src="./dist/assets/images/сard/therapist.png" alt="img">\n                                </picture>\n                            </div>\n                            <p class="card-title__doctor-text-value">${this.doctor}</p>\n                        </div>\n                    </div>\n                    <div class="card-title__status">\n                        <div class="card-title__status-head">VISIT STATUS:</div>\n                        <button class="card-title__status-text">${this.status.toUpperCase()}</button>\n                    </div>\n                </div>\n                <div class="card__element card-main">\n                    <div class="card-main__patient">\n                        <div class="card-main__patient-head">\n                            <p class="card-main__patient-head-title">PACIENT:</p>\n                            ${this.age?`<p class="card-main__patient-head-age">AGE:<span class="card-main__patient-head-age-val">${this.age}</span></p>`:""}\n                        </div>\n                        <div class="card-main__patient-text">${this.patient}</div>\n                    </div>\n                    <div class="card-main__urgency">\n                        <div class="card-main__urgency-head">URGENCY</div>\n                        <div class="card-main__urgency-body" data-urgency="${this.urgency}">\n                            <div class="urgency-body__elem urgency-body__elem--${this.urgency}"></div>\n                            <div class="urgency-body__elem urgency-body__elem--${this.urgency}"></div>\n                            <div class="urgency-body__elem urgency-body__elem--${this.urgency}"></div>\n                        </div>\n                    </div>\n                </div>\n                <div class="card-additional card-additional--hide">\n                    <div class="card-additional__purpose">\n                        <div class="card-additional__purpose-title">PURPOSE OF THE TARGET:</div>\n                        <div class="card-additional__purpose-text">${this.purpose}</div>\n                    </div>\n                    <div class="card-additional__description">\n                        <div class="card-additional__description-title">DESCRIPTION:</div>\n                        <div class="card-additional__description-text">${this.description}</div>\n                    </div>\n                    ${this.lastVisit?`\n                    <div class="card-additional__date">\n                        <div class="card-additional__date-title">DATE OF LAST VISIT:</div>\n                        <div class="card-additional__date-text">${this.lastVisit}</div>\n                    </div>`:""}\n                    ${this.BMI?`\n                    <div class="card-additional__imt">\n                        <div class="card-additional__imt-title">BMI:</div>\n                        <div class="card-additional__imt-text">${this.BMI} BMI</div>\n                    </div>`:""}\n                    ${this.pressure?`\n                    <div class="card-additional__pressure">\n                        <div class="card-additional__pressure-title">PRESSURE:</div>\n                        <div class="card-additional__pressure-text">${this.pressure} mmHg</div>\n                    </div>`:""}\n                    ${this.diseases?`\n                    <div class="card-additional__diseases">\n                        <div class="card-additional__diseases-title">DISEASES OF THE CARDIOVASCULAR:</div>\n                        <div class="card-additional__diseases-text">${this.diseases}</div>\n                    </div>`:""}\n                </div>\n                <div class="card-show-more">\n                    <button class="card-show-more__btn">SHOW MORE DETAILS</button>\n                    <picture>\n                        <source srcset="./dist/assets/images/icon-down.webp" type="image/webp">\n                        <img class="card-show-more__icon" src="./dist/assets/images/icon-down.png" alt="icon">\n                    </picture>\n                </div>\n                <div class="card-hide-more card-hide-more--hide">\n                    <button class="card-hide-more__btn">HIDE MORE DETAILS</button>\n                    <picture>\n                        <source srcset="./dist/assets/images/icon-up.webp" type="image/webp">\n                        <img class="card-hide-more__icon" src="./dist/assets/images/icon-up.png" alt="icon">\n                    </picture>\n                 </div>\n            </div>`);const s=t.querySelector(".card-del"),i=t.querySelector(".card-show-more__btn"),a=t.querySelector(".card-hide-more__btn"),r=t.querySelector(".card-additional"),n=t.querySelector(".card-change"),o=t.querySelector(".card-title__status-text");s.addEventListener("click",(()=>this.delete(t))),i.addEventListener("click",(()=>this.showDetails(i,a,r))),a.addEventListener("click",(()=>this.hideDetails(i,a,r))),n.addEventListener("click",(()=>this.openCardEditor())),o.addEventListener("click",(()=>this.changeStatus(o))),this.checkStatus(o)}async delete(t){200===(await(async e=>await fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.token)}`}}))(t.id)).status&&t.remove(),e.delCardById(this.id),v()}showDetails(e,t,s){e.parentNode.classList.add("card-show-more--hide"),t.parentNode.classList.remove("card-hide-more--hide"),s.classList.remove("card-additional--hide")}hideDetails(e,t,s){e.parentNode.classList.remove("card-show-more--hide"),t.parentNode.classList.add("card-hide-more--hide"),s.classList.add("card-additional--hide")}openCardEditor(){!function(e){const s=document.body.querySelector(".modal"),i=new t(s),a=e;i.showEditModal(a);const r=s.querySelector("button.submit");r.setAttribute("disabled",!0),r.textContent="Save Changes";s.querySelector(".form-visit").addEventListener("submit",(t=>{const r=i.createVisitParams(t),n={...a,...r};e.saveChangesOnServer(n),s.innerHTML="",s.classList.add("modal--hide")}))}(this)}async changeStatus(e){const t=e=>this.saveChangesOnServer({...this,status:e});"OPEN"===e.textContent&&await t("done")?(e.innerHTML="DONE",e.closest(".card").classList.add("card-visit-done")):"DONE"===e.textContent&&await t("open")&&(e.innerHTML="OPEN",this.status="open")}checkStatus(e){"DONE"===e.textContent&&e.closest(".card").classList.add("card-visit-done")}async saveChangesOnServer(t){const s=await(async(e,t)=>200===(await fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(sessionStorage.token)}`},body:JSON.stringify(t)})).status||(alert("Failed to change card. Server is not available"),!1))(t.id,t);return s&&(e.data=e.data.map((e=>e.id===t.id?t:e)),e.sortNow(),document.querySelector(".cards__content").innerHTML="",w()),s}}class i{constructor({purpose:e,description:t,urgency:s,patient:i}){this.purpose=e,this.description=t,this.urgency=s,this.patient=i,this.status="open",this.date=(new Date).toLocaleString("ua").slice(0,-3)}createJSON(e){return JSON.stringify({purpose:this.purpose,description:this.description,urgency:this.urgency,patient:this.patient,status:this.status,date:this.date,...e})}async sendVisitDataToServer(e){return(async e=>{const t=await fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(sessionStorage.token)}`},body:e});return 200===t.status?t.json():void alert("Failed to create card. Server is not available")})(this.createJSON(e))}}class a extends i{constructor({purpose:e,description:t,urgency:s,patient:i,pressure:a,BMI:r,diseases:n,age:o}){super({purpose:e,description:t,urgency:s,patient:i}),this.pressure=a,this.BMI=r,this.diseases=n,this.age=o}visit(){const e={doctor:"cardiologist",pressure:this.pressure,BMI:this.BMI,diseases:this.diseases,age:this.age};return this.sendVisitDataToServer(e)}}class r extends i{constructor({purpose:e,description:t,urgency:s,patient:i,lastVisit:a}){super({purpose:e,description:t,urgency:s,patient:i}),this.lastVisit=a}visit(){const e={doctor:"dentist",lastVisit:this.lastVisit};return this.sendVisitDataToServer(e)}}class n extends i{constructor({purpose:e,description:t,urgency:s,patient:i,age:a}){super({purpose:e,description:t,urgency:s,patient:i}),this.age=a}visit(){const e={doctor:"therapist",age:this.age};return this.sendVisitDataToServer(e)}}const o=document.body.querySelector(".btn__login"),d=document.body.querySelector(".btn__visit"),c=document.body.querySelector(".btn__logout"),l=document.body.querySelector(".modal");function u(){d.classList.remove("hide"),c.classList.remove("hide"),o.classList.add("hide")}async function p(){const t=await(async()=>{const e=await fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${JSON.parse(sessionStorage.token)}`}});return 200===e.status?e.json():void alert("Failed to load cards. Server is not available")})();e.data=[...t],e.sortNow(),w(),v()}function m(e){e.forEach(((e,t)=>{setTimeout((()=>{new s(e).render()}),100*t)}))}function v(){const t=document.body.querySelector(".no-content"),s=document.body.querySelectorAll('button[name*="search"]');setTimeout((()=>{sessionStorage.getItem("token")?e.data.length?(t.classList.add("no-content--hide"),s.forEach((e=>e.removeAttribute("disabled")))):(t.innerHTML="No items have been added",t.classList.remove("no-content--hide")):(t.innerHTML="You are not authorized",t.classList.remove("no-content--hide"),s.forEach((e=>e.setAttribute("disabled",!0))))}))}o.addEventListener("click",(()=>{return new t(e=l).showLoginForm(),void e.querySelector('button[type="submit"]').addEventListener("click",(t=>async function(e,t){e.preventDefault();const s=t.querySelector('input[name="username"]').value,i=t.querySelector('input[name="password"]').value,a=await(async(e,t)=>{const s=await fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});return 200===s.status&s.ok?s.text():void alert("Incorrect login or password")})(s,i);a&&(t.innerHTML="",t.classList.add("modal--hide"),sessionStorage.clear(),sessionStorage.token=JSON.stringify(a),p(),u())}(t,e)));var e})),d.addEventListener("click",(()=>function(s){const i=new t(s);i.showDefaultVisit();const o=s.querySelector("#select-doctor"),d=s.querySelector(".form-visit");o.addEventListener("input",(()=>{i.showSpecificFields(o.value)})),d.addEventListener("submit",(t=>async function(t,s,i){let o;"cardiologist"===t&&(o=new a(s)),"dentist"===t&&(o=new r(s)),"therapist"===t&&(o=new n(s));const d=await o.visit();d&&(e.data.push(d),e.sortNow(),i.innerHTML="",i.classList.add("modal--hide"),w(),v())}(o.value,i.createVisitParams(t),s)))}(l))),c.addEventListener("click",(()=>function(){const e=document.body.querySelector(".cards__content");c.classList.add("hide"),d.classList.add("hide"),o.classList.remove("hide"),sessionStorage.clear(),e.innerHTML="",v()}())),sessionStorage.getItem("token")&&u(),sessionStorage.getItem("token")?p():v();const h=document.body.querySelector(".search-form__input"),_=document.body.querySelector('select[name="search-status"]'),y=document.body.querySelector('select[name="search-priority"]'),b=document.body.querySelector('button[name="search-button"]'),g=document.body.querySelector('button[name="search-all"]'),f=document.body.querySelector(".cards__content"),S=[h,_,y];function w(){const t=JSON.parse(sessionStorage.getItem("filter"));if(t){const i=(s=t,e.data.filter((e=>s.urgency?e.urgency===s.urgency:e)).filter((e=>s.text?[e.patient,e.description,e.purpose,e.age].some((e=>{if(e)return e.toLowerCase().includes(s.text.toLowerCase())})):e)).filter((e=>s.status?e.status===s.status:e)));f.innerHTML="",L(i),m(i)}else f.innerHTML="",m(e.data);var s}function L(e){const t=document.body.querySelector(".no-search");e.length?t.classList.add("no-search--hide"):t.classList.remove("no-search--hide")}function E(){[b,g].forEach((e=>e.classList.add("disabled"))),[h,_,y].forEach((e=>e.addEventListener("input",(()=>{e.value?[b,g].forEach((e=>e.classList.remove("disabled"))):[b,g].forEach((e=>e.classList.add("disabled")))}))))}b.addEventListener("click",(()=>{Object.keys(function(){const e={...!!h.value&&{text:h.value},...!!_.value&&{status:_.value},...!!y.value&&{urgency:y.value}};return sessionStorage.filter=JSON.stringify(e),e}()).length&&w()})),g.addEventListener("click",(()=>{E(),sessionStorage.removeItem("filter"),S.some((e=>!!e.value))&&(S.forEach((e=>e.value="")),f.innerHTML="",L(e.data),w())})),E(),function(){const e=JSON.parse(sessionStorage.getItem("filter"));e?(e.text&&(h.value=e.text),e.urgency&&(y.value=e.urgency),e.status&&(_.value=e.status),Object.keys(e)&&[b,g].forEach((e=>e.classList.remove("disabled")))):[b,g].forEach((e=>e.classList.add("disabled")))}(),(e=>{const t=new Image;t.onload=t.onerror=()=>{(e=>{const t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)})(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})()})();